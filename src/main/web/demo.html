<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1> Hello </h1>
<canvas id="board" width="1600" height="1000"></canvas>

<h1 id="title"></h1>
<hr>

<div id="text"></div>

<h1 id="title2"></h1>
<hr>
<div id="text2"></div>



<script>
    var board = document.getElementById("board");
    var ctx = board.getContext("2d");
    ctx.rect(0,0,board.width, board.height);
    ctx.fillStyle = "black";
    ctx.fill();
    var imageData = ctx.getImageData(0,0,board.width,board.height);
    function ajax_get(url, callback) {
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function() {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                console.log('responseText:' + xmlhttp.responseText);
                try {
                    var data = JSON.parse(xmlhttp.responseText);
                } catch(err) {
                    console.log(err.message + " in " + xmlhttp.responseText);
                    return;
                }
                callback(data);
            }
        };

        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }

        ajax_get('http://localhost:8088/map', function(data) {


            //var html = "<h2>" + "Hello"+ "</h2>";

            //html += "<ul>";
            let ctx = board.getContext("2d");
            for (var i=0; i < data.length; i++) {
                //html +="<h3>Road "+i+"</h3>";
                for(var j = 0; j<data[i].length;j++){
                    //html += '<li><a href="' + data[i].x + '">' + data[i][j].pos1.x +' - '+ data[i][j].pos1.y + ' / ' + data[i][j].pos2.x +' - '+ data[i][j].pos2.y+"</a></li>";
                    ctx.strokeStyle = "grey";
                    ctx.lineWidth=1;
                    ctx.moveTo(data[i][j].pos1.x,data[i][j].pos1.y);
                    ctx.lineTo(data[i][j].pos2.x,data[i][j].pos2.y);
                    ctx.stroke();
                }

            }
            imageData = ctx.getImageData(0,0,board.width,board.height);
            //html += "</ul>";
            //document.getElementById("text2").innerHTML = html;
            Console.log("hello");
        });


    function ajax_repeat(){
        ajax_get('http://localhost:8088/cars', function(data) {


            //var html = "<h2>" + "Hello"+ "</h2>";

            //html += "<ul>";
            let ctx = board.getContext("2d");
            ctx.putImageData(imageData,0,0);
            for (var i=0; i < data.length; i++) {
               // html += '<li><a href="' + data[i].x + '">' + data[i].x +' '+ data[i].y + "</a></li>";
                ctx.beginPath();
                ctx.strokeStyle = "yellow"
                ctx.rect(data[i].x-1,data[i].y-1,2,2);
                ctx.stroke();
            }
            //html += "</ul>";
            //document.getElementById("text").innerHTML = html;
        });
    }



    setInterval(ajax_repeat, 20);
</script>


</body>
</html>